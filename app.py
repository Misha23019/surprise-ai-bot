import os
from pytz import UTC
from telegram.ext import (
    ApplicationBuilder,
    CommandHandler,
    MessageHandler,
    CallbackQueryHandler,
    filters,
)
from modules.router import start, time_handler, button_handler, language_selection_handler
from modules.scheduler import start_scheduler

TOKEN = os.getenv("TELEGRAM_BOT_TOKEN") or os.getenv("TELEGRAM_TOKEN")

def main():
    # –ó–∞–¥–∞—î–º–æ pytz.UTC —è–≤–Ω–æ
    application = ApplicationBuilder().token(TOKEN).local_timezone(UTC).build()

    # –û–±—Ä–æ–±–Ω–∏–∫–∏
    application.add_handler(CommandHandler("start", start))
    application.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, time_handler))
    application.add_handler(CallbackQueryHandler(button_handler))
    application.add_handler(MessageHandler(filters.Regex(r'^üåê'), language_selection_handler))

    # –°—Ç–∞—Ä—Ç—É—î–º–æ –ø–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫
    start_scheduler(application.job_queue)

    # –°—Ç–∞—Ä—Ç—É—î–º–æ –±–æ—Ç–∞
    application.run_polling()

if __name__ == "__main__":
    main()
